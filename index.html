<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Portal de acceso seguro al Sistema SDMO">
  <meta name="theme-color" content="#1e293b">
  <meta name="robots" content="noindex, nofollow">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <title>Acceso Seguro - SDMO</title>

  <link rel="stylesheet" href="public/app.css">
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script src="public/config.js"></script>


  
<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  // Lee la config centralizada (public/config.js)
  const { SUPABASE_URL, SUPABASE_ANON_KEY } = window.SDMO_CONFIG || {};

  const CONFIG = {
    supabaseUrl: SUPABASE_URL,
    supabaseKey: SUPABASE_ANON_KEY,
    redirectUrl: 'inicio.html',        // cambia si quieres otro destino
    maxAttempts: 5,
    lockoutTime: 15 * 60 * 1000,       // 15 min
    sessionTimeout: 60 * 60 * 1000     // 1 hora
  };

  if (!CONFIG.supabaseUrl || !CONFIG.supabaseKey) {
    alert('Falta configurar public/config.js con SUPABASE_URL y SUPABASE_ANON_KEY');
  }

  const supabase = createClient(CONFIG.supabaseUrl, CONFIG.supabaseKey);

  // ⬇️ A PARTIR DE AQUÍ deja TODO tu código tal cual está (SecurityUtils, SessionManager, etc.)



    // Utilidades de seguridad
    const SecurityUtils = {
      // Sanitizar entrada de usuario
      sanitizeInput(input) {
        return input.trim().replace(/[<>]/g, '');
      },

      // Validar email con regex más robusta
      isValidEmail(email) {
        const emailPattern = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
        return emailPattern.test(email) && email.length <= 254;
      },

      // Validar contraseña
      validatePassword(password) {
        return {
          isValid: password.length >= 8,
          message: password.length < 8 ? 'La contraseña debe tener al menos 8 caracteres' : ''
        };
      },

      // Gestión de intentos fallidos
      getFailedAttempts() {
        const attempts = JSON.parse(localStorage.getItem('sdmo_failed_attempts') || '{}');
        const now = Date.now();
        // Limpiar intentos antiguos
        Object.keys(attempts).forEach(timestamp => {
          if (now - parseInt(timestamp) > CONFIG.lockoutTime) {
            delete attempts[timestamp];
          }
        });
        localStorage.setItem('sdmo_failed_attempts', JSON.stringify(attempts));
        return Object.keys(attempts).length;
      },

      addFailedAttempt() {
        const attempts = JSON.parse(localStorage.getItem('sdmo_failed_attempts') || '{}');
        attempts[Date.now()] = true;
        localStorage.setItem('sdmo_failed_attempts', JSON.stringify(attempts));
      },

      clearFailedAttempts() {
        localStorage.removeItem('sdmo_failed_attempts');
      },

      isAccountLocked() {
        return this.getFailedAttempts() >= CONFIG.maxAttempts;
      },

      getRemainingLockoutTime() {
        const attempts = JSON.parse(localStorage.getItem('sdmo_failed_attempts') || '{}');
        const timestamps = Object.keys(attempts).map(t => parseInt(t)).sort((a, b) => b - a);
        if (timestamps.length === 0) return 0;
        
        const oldestRelevantAttempt = timestamps[CONFIG.maxAttempts - 1];
        const timeRemaining = CONFIG.lockoutTime - (Date.now() - oldestRelevantAttempt);
        return Math.max(0, timeRemaining);
      }
    };

    // Gestión de sesión
    const SessionManager = {
      setSession(user) {
        const sessionData = {
          user: {
            id: user.id,
            email: user.email,
            lastActivity: Date.now()
          },
          loginTime: Date.now()
        };
        sessionStorage.setItem('sdmo_session', JSON.stringify(sessionData));
      },

      clearSession() {
        sessionStorage.removeItem('sdmo_session');
        localStorage.removeItem('sdmo_session_check');
      },

      isSessionValid() {
        const session = sessionStorage.getItem('sdmo_session');
        if (!session) return false;

        try {
          const data = JSON.parse(session);
          const now = Date.now();
          return (now - data.user.lastActivity) < CONFIG.sessionTimeout;
        } catch {
          return false;
        }
      }
    };

    // Gestión de accesibilidad
    const AccessibilityManager = {
      announceToScreenReader(message, priority = 'polite') {
        const announcer = document.getElementById('screenReaderAnnouncer');
        announcer.setAttribute('aria-live', priority);
        announcer.textContent = message;
        
        setTimeout(() => {
          announcer.textContent = '';
        }, 1000);
      },

      manageFocus() {
        // Trap focus dentro del formulario durante el loading
        const form = document.getElementById('loginForm');
        const focusableElements = form.querySelectorAll(
          'input, button, [tabindex]:not([tabindex="-1"])'
        );
        
        if (focusableElements.length > 0) {
          focusableElements[0].focus();
        }
      }
    };

    // Inicializador principal de la aplicación
    function initApp() {
      const elements = {
        loginForm: document.getElementById("loginForm"),
        emailInput: document.getElementById("email"),
        passwordInput: document.getElementById("password"),
        submitBtn: document.getElementById("submitBtn"),
        errorElement: document.getElementById("errorMsg"),
        passwordToggle: document.getElementById("passwordToggle"),
        rememberMe: document.getElementById("rememberMe"),
        strengthIndicator: document.getElementById("passwordStrength")
      };

      // Verificar estado inicial
      checkInitialState();
      
      // Configurar event listeners
      setupEventListeners(elements);
      
      // Restaurar email guardado
      restoreUserPreferences(elements);

      // Configurar validación en tiempo real
      setupRealTimeValidation(elements);

      function checkInitialState() {
        // Verificar si hay un error en la URL
        checkUrlParams();
        
        // Verificar si la cuenta está bloqueada
        if (SecurityUtils.isAccountLocked()) {
          const remainingTime = SecurityUtils.getRemainingLockoutTime();
          if (remainingTime > 0) {
            showAccountLocked(remainingTime);
          } else {
            SecurityUtils.clearFailedAttempts();
          }
        }

        // Verificar sesión existente
        checkExistingSession();
      }

      function setupEventListeners(elements) {
        // Submit del formulario
        elements.loginForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          await handleLogin(elements);
        });

        // Toggle de contraseña
        elements.passwordToggle.addEventListener("click", () => {
          togglePasswordVisibility(elements.passwordInput, elements.passwordToggle);
        });

        // Limpiar errores cuando el usuario escribe
        elements.emailInput.addEventListener("input", () => {
          clearError();
          validateEmailField(elements.emailInput);
        });

        elements.passwordInput.addEventListener("input", () => {
          clearError();
          updatePasswordStrength(elements.passwordInput.value);
        });

        // Navegación por teclado mejorada
        elements.loginForm.addEventListener("keydown", (e) => {
          if (e.key === 'Enter' && e.target.type !== 'submit') {
            e.preventDefault();
            const inputs = Array.from(elements.loginForm.querySelectorAll('input'));
            const currentIndex = inputs.indexOf(e.target);
            if (currentIndex < inputs.length - 1) {
              inputs[currentIndex + 1].focus();
            } else {
              elements.submitBtn.focus();
            }
          }
        });

        // Prevenir ataques de fuerza bruta con rate limiting
        let lastSubmitTime = 0;
        elements.loginForm.addEventListener("submit", (e) => {
          const now = Date.now();
          if (now - lastSubmitTime < 1000) { // Máximo 1 intento por segundo
            e.preventDefault();
            showError("Por favor espere un momento antes de intentar nuevamente");
            return;
          }
          lastSubmitTime = now;
        });
      }

      function setupRealTimeValidation(elements) {
        // Validación de email en tiempo real
        elements.emailInput.addEventListener("blur", () => {
          validateEmailField(elements.emailInput);
        });

        // Validación de contraseña en tiempo real
        elements.passwordInput.addEventListener("input", (e) => {
          updatePasswordStrength(e.target.value);
        });
      }

      function validateEmailField(emailInput) {
        const email = SecurityUtils.sanitizeInput(emailInput.value);
        const isValid = SecurityUtils.isValidEmail(email);
        
        emailInput.setAttribute("aria-invalid", !isValid);
        
        if (!isValid && email.length > 0) {
          emailInput.style.borderColor = "var(--error-color)";
        } else {
          emailInput.style.borderColor = "var(--border-color)";
        }
      }

      function updatePasswordStrength(password) {
        const strengthElement = elements.strengthIndicator;
        if (!strengthElement || password.length === 0) {
          if (strengthElement) strengthElement.style.display = 'none';
          return;
        }

        let strength = 0;
        let feedback = [];

        // Criterios de fortaleza
        if (password.length >= 8) strength++;
        else feedback.push("Mínimo 8 caracteres");

        if (/[a-z]/.test(password)) strength++;
        else feedback.push("Una minúscula");

        if (/[A-Z]/.test(password)) strength++;
        else feedback.push("Una mayúscula");

        if (/\d/.test(password)) strength++;
        else feedback.push("Un número");

        if (/[^a-zA-Z\d]/.test(password)) strength++;
        else feedback.push("Un carácter especial");

        const levels = ['Muy débil', 'Débil', 'Regular', 'Buena', 'Fuerte'];
        const colors = ['#e74c3c', '#f39c12', '#f1c40f', '#27ae60', '#2ecc71'];

        strengthElement.textContent = `Fortaleza: ${levels[strength]}`;
        strengthElement.style.color = colors[strength];
        strengthElement.style.display = 'block';

        if (feedback.length > 0) {
          strengthElement.title = `Falta: ${feedback.join(', ')}`;
        }
      }

      async function handleLogin(elements) {
        try {
          // Verificar si la cuenta está bloqueada
          if (SecurityUtils.isAccountLocked()) {
            const remainingTime = SecurityUtils.getRemainingLockoutTime();
            if (remainingTime > 0) {
              showAccountLocked(remainingTime);
              return;
            } else {
              SecurityUtils.clearFailedAttempts();
            }
          }

          const email = SecurityUtils.sanitizeInput(elements.emailInput.value);
          const password = elements.passwordInput.value;
          const rememberMe = elements.rememberMe.checked;

          // Validaciones
          if (!email || !password) {
            showError("Por favor complete todos los campos requeridos");
            AccessibilityManager.announceToScreenReader("Error: Campos incompletos", "assertive");
            return;
          }

          if (!SecurityUtils.isValidEmail(email)) {
            showError("Por favor ingrese un correo electrónico válido");
            elements.emailInput.focus();
            return;
          }

          const passwordValidation = SecurityUtils.validatePassword(password);
          if (!passwordValidation.isValid) {
            showError(passwordValidation.message);
            elements.passwordInput.focus();
            return;
          }

          showLoading(true, elements.submitBtn);
          clearError();

          // Gestionar recordar usuario
          if (rememberMe) {
            localStorage.setItem('sdmo_email', email);
            localStorage.setItem('sdmo_remember', 'true');
          } else {
            localStorage.removeItem('sdmo_email');
            localStorage.removeItem('sdmo_remember');
          }

          // Autenticación con Supabase
          const { data, error } = await supabase.auth.signInWithPassword({ 
            email, 
            password 
          });

          if (error) throw error;

          // Login exitoso
          SecurityUtils.clearFailedAttempts();
          SessionManager.setSession(data.user);
          
          // Auditoría de seguridad
          logSecurityEvent('successful_login', { 
            email, 
            timestamp: new Date().toISOString(),
            userAgent: navigator.userAgent 
          });

          AccessibilityManager.announceToScreenReader("Inicio de sesión exitoso. Redirigiendo...", "assertive");
          
          // Redirección con pequeño delay para UX
          setTimeout(() => {
            window.location.href = CONFIG.redirectUrl;
          }, 500);

        } catch (error) {
          console.error("Error de autenticación:", error);
          
          // Registrar intento fallido
          SecurityUtils.addFailedAttempt();
          
          // Auditoría de seguridad
          logSecurityEvent('failed_login', { 
            email: elements.emailInput.value,
            error: error.message,
            timestamp: new Date().toISOString(),
            attempts: SecurityUtils.getFailedAttempts()
          });

          // Manejo de errores específicos
          let errorMessage = "Error al iniciar sesión. Intente nuevamente.";
          
          if (error.message.includes("Email not confirmed")) {
            errorMessage = "Correo electrónico no verificado. Revise su bandeja de entrada y confirme su cuenta.";
          } else if (error.message.includes("Invalid login credentials")) {
            const remainingAttempts = CONFIG.maxAttempts - SecurityUtils.getFailedAttempts();
            if (remainingAttempts > 0) {
              errorMessage = `Credenciales incorrectas. Le quedan ${remainingAttempts} intentos.`;
            } else {
              showAccountLocked(CONFIG.lockoutTime);
              return;
            }
          } else if (error.message.includes("Too many requests")) {
            errorMessage = "Demasiados intentos. Espere unos minutos antes de intentar nuevamente.";
          }

          showError(errorMessage);
          AccessibilityManager.announceToScreenReader(`Error: ${errorMessage}`, "assertive");
          
        } finally {
          showLoading(false, elements.submitBtn);
        }
      }

      function togglePasswordVisibility(passwordInput, toggleButton) {
        const isPassword = passwordInput.type === 'password';
        passwordInput.type = isPassword ? 'text' : 'password';
        
        toggleButton.innerHTML = isPassword ? 
          '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>' : 
          '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>';
        
        toggleButton.setAttribute('aria-label', isPassword ? 'Ocultar contraseña' : 'Mostrar contraseña');
        
        // Anunciar cambio a lectores de pantalla
        AccessibilityManager.announceToScreenReader(
          isPassword ? 'Contraseña visible' : 'Contraseña oculta'
        );
      }

      function showError(message) {
        elements.errorElement.textContent = message;
        elements.errorElement.style.display = "block";
        elements.errorElement.classList.add("error-shake");
        
        setTimeout(() => {
          elements.errorElement.classList.remove("error-shake");
        }, 500);

        // Scroll hasta el error si es necesario
        elements.errorElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }

      function clearError() {
        elements.errorElement.textContent = "";
        elements.errorElement.style.display = "none";
      }

      function showLoading(show, button) {
        if (show) {
          button.disabled = true;
          button.innerHTML = 'Verificando credenciales <span class="loader"></span>';
          AccessibilityManager.announceToScreenReader("Iniciando sesión...");
        } else {
          button.disabled = false;
          button.textContent = 'Iniciar Sesión';
        }
      }

      function showAccountLocked(remainingTime) {
        const minutes = Math.ceil(remainingTime / (60 * 1000));
        const message = `Cuenta temporalmente bloqueada por seguridad. Intente nuevamente en ${minutes} minuto${minutes !== 1 ? 's' : ''}.`;
        
        showError(message);
        elements.submitBtn.disabled = true;
        
        // Countdown timer
        const interval = setInterval(() => {
          const newRemainingTime = SecurityUtils.getRemainingLockoutTime();
          if (newRemainingTime <= 0) {
            clearInterval(interval);
            clearError();
            elements.submitBtn.disabled = false;
            SecurityUtils.clearFailedAttempts();
            AccessibilityManager.announceToScreenReader("Cuenta desbloqueada. Puede intentar nuevamente.");
          } else {
            const mins = Math.ceil(newRemainingTime / (60 * 1000));
            elements.errorElement.textContent = `Cuenta bloqueada. Intente en ${mins} minuto${mins !== 1 ? 's' : ''}.`;
          }
        }, 30000); // Actualizar cada 30 segundos
      }

      function restoreUserPreferences(elements) {
        const savedEmail = localStorage.getItem('sdmo_email');
        const rememberPref = localStorage.getItem('sdmo_remember');
        
        if (savedEmail && rememberPref === 'true') {
          elements.emailInput.value = savedEmail;
          elements.rememberMe.checked = true;
          elements.passwordInput.focus(); // Focus en contraseña si email ya está
        } else {
          elements.emailInput.focus(); // Focus en email si no hay datos guardados
        }
      }

      function checkUrlParams() {
        const urlParams = new URLSearchParams(window.location.search);
        const errorMsg = urlParams.get('error');
        
        if (errorMsg) {
          showError(decodeURIComponent(errorMsg));
          // Limpiar URL después de mostrar el error
          window.history.replaceState({}, document.title, window.location.pathname);
        }
      }

      function checkExistingSession() {
        if (SessionManager.isSessionValid()) {
          // Ya hay una sesión válida, redirigir
          window.location.href = CONFIG.redirectUrl;
        }
      }

      function logSecurityEvent(eventType, details) {
        // En un entorno real, esto enviaría logs a un servicio de auditoría
        const logEntry = {
          type: eventType,
          timestamp: new Date().toISOString(),
          ip: 'client-side', // En producción, obtener del servidor
          ...details
        };
        
        console.log('Security Event:', logEntry);
        
        // Almacenar localmente para debugging (remover en producción)
        const logs = JSON.parse(localStorage.getItem('sdmo_security_logs') || '[]');
        logs.push(logEntry);
        // Mantener solo los últimos 50 logs
        if (logs.length > 50) {
          logs.splice(0, logs.length - 50);
        }
        localStorage.setItem('sdmo_security_logs', JSON.stringify(logs));
      }
    }

    // Verificar compatibilidad del navegador
    function checkBrowserCompatibility() {
      const requiredFeatures = [
        'fetch',
        'Promise',
        'localStorage',
        'sessionStorage'
      ];

      const unsupportedFeatures = requiredFeatures.filter(feature => !(feature in window));
      
      if (unsupportedFeatures.length > 0) {
        document.body.innerHTML = `
          <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
            <h2>Navegador no compatible</h2>
            <p>Su navegador no soporta las funciones necesarias para usar este sistema.</p>
            <p>Por favor actualice su navegador o use uno más reciente.</p>
            <p><small>Funciones faltantes: ${unsupportedFeatures.join(', ')}</small></p>
          </div>
        `;
        return false;
      }
      return true;
    }

    // Inicialización cuando el DOM esté listo
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        if (checkBrowserCompatibility()) {
          initApp();
        }
      });
    } else {
      if (checkBrowserCompatibility()) {
        initApp();
      }
    }

    // Manejo de errores globales
    window.addEventListener('error', (event) => {
      console.error('Error global:', event.error);
      // En producción, enviar a servicio de logging
    });

    window.addEventListener('unhandledrejection', (event) => {
      console.error('Promise rechazada:', event.reason);
      // En producción, enviar a servicio de logging
    });
  </script>
  
  <style>
    :root {
      /* Colores principales - Dark Theme */
      --primary-color: #60a5fa;
      --primary-dark: #3b82f6;
      --primary-light: #93c5fd;
      
      /* Colores de texto */
      --text-color: #f1f5f9;
      --text-secondary: #94a3b8;
      
      /* Colores de estado */
      --error-color: #f87171;
      --success-color: #34d399;
      --warning-color: #fbbf24;
      
      /* Colores de fondo */
      --background-color: #0f172a;
      --card-background: #1e293b;
      --border-color: #334155;
      
      /* Sombras */
      --shadow-color: rgba(0,0,0,0.4);
      --shadow-hover: rgba(0,0,0,0.6);
      --focus-shadow: rgba(96,165,250,0.4);
      --focus-ring: 0 0 0 3px var(--focus-shadow);
      
      /* Otros */
      --border-radius: 12px;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --primary-color: #60a5fa;
        --primary-dark: #3b82f6;
        --primary-light: #93c5fd;
        --text-color: #f1f5f9;
        --text-secondary: #94a3b8;
        --error-color: #f87171;
        --success-color: #34d399;
        --warning-color: #fbbf24;
        --background-color: #0f172a;
        --card-background: #1e293b;
        --border-color: #334155;
        --shadow-color: rgba(0,0,0,0.4);
        --shadow-hover: rgba(0,0,0,0.6);
        --focus-shadow: rgba(96,165,250,0.4);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      :root {
        --transition: none;
      }
      
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, var(--background-color) 0%, #0c1420 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      color: var(--text-color);
      line-height: 1.6;
      transition: var(--transition);
    }
    
    .login-container {
      width: 100%;
      max-width: 420px;
      text-align: center;
    }
    
    .logo {
      margin-bottom: 30px;
      max-width: 120px;
      height: auto;
      filter: drop-shadow(0 4px 8px var(--shadow-color)) brightness(1.2);
    }

    .system-title {
      background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
      letter-spacing: -0.02em;
    }

    .system-subtitle {
      color: var(--text-secondary);
      font-size: 16px;
      font-weight: 400;
      margin-bottom: 32px;
    }
    
    .login-form {
      background: var(--card-background);
      padding: 40px 32px;
      border-radius: var(--border-radius);
      box-shadow: 
        0 10px 25px -5px var(--shadow-color),
        0 8px 10px -6px var(--shadow-color);
      border: 1px solid var(--border-color);
      transition: var(--transition);
      backdrop-filter: blur(10px);
    }

    .login-form:hover {
      box-shadow: 
        0 20px 25px -5px var(--shadow-hover),
        0 8px 10px -6px var(--shadow-hover);
      border-color: #475569;
    }
    
    .form-group {
      margin-bottom: 24px;
      text-align: left;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text-color);
      font-size: 14px;
      letter-spacing: 0.01em;
    }

    .form-label.required::after {
      content: ' *';
      color: var(--error-color);
    }
    
    .form-input {
      width: 100%;
      padding: 14px 16px;
      font-size: 16px;
      border-radius: 8px;
      border: 2px solid var(--border-color);
      transition: var(--transition);
      background-color: #0f172a;
      color: var(--text-color);
      font-family: inherit;
    }

    .form-input::placeholder {
      color: #64748b;
      opacity: 0.8;
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: var(--focus-ring);
      background-color: #1e293b;
    }

    .form-input:invalid {
      border-color: var(--error-color);
    }

    .form-input:valid:not(:placeholder-shown) {
      border-color: var(--success-color);
    }
    
    .password-container {
      position: relative;
    }
    
    .password-toggle {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 8px;
      border-radius: 4px;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .password-toggle:hover {
      color: var(--text-color);
      background-color: rgba(148, 163, 184, 0.1);
    }

    .password-toggle:focus {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    .password-strength {
      font-size: 12px;
      margin-top: 4px;
      font-weight: 500;
      display: none;
    }
    
    .form-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      font-size: 14px;
    }
    
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .form-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: var(--primary-color);
    }

    .form-checkbox:focus {
      outline: none;
      box-shadow: var(--focus-ring);
      border-radius: 2px;
    }

    .forgot-password {
      color: var(--primary-color);
      text-decoration: none;
      transition: var(--transition);
      font-weight: 500;
    }

    .forgot-password:hover {
      color: var(--primary-light);
      text-decoration: underline;
    }

    .forgot-password:focus {
      outline: none;
      box-shadow: var(--focus-ring);
      border-radius: 4px;
      padding: 2px 4px;
    }
    
    .submit-button {
      width: 100%;
      padding: 16px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
      color: white;
      border: none;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      letter-spacing: 0.01em;
      position: relative;
      overflow: hidden;
    }

    .submit-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }

    .submit-button:hover::before {
      left: 100%;
    }
    
    .submit-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(96, 165, 250, 0.4);
    }
    
    .submit-button:active:not(:disabled) {
      transform: translateY(0);
    }
    
    .submit-button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    .submit-button:focus {
      outline: none;
      box-shadow: var(--focus-ring);
    }
    
    .error-message {
      color: var(--error-color);
      font-size: 14px;
      text-align: center;
      padding: 12px;
      margin-bottom: 16px;
      border-radius: 8px;
      background-color: rgba(248, 113, 113, 0.1);
      border: 1px solid rgba(248, 113, 113, 0.3);
      display: none;
      transition: var(--transition);
    }
    
    .error-shake {
      animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
    }
    
    @keyframes shake {
      10%, 90% { transform: translate3d(-1px, 0, 0); }
      20%, 80% { transform: translate3d(2px, 0, 0); }
      30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
      40%, 60% { transform: translate3d(4px, 0, 0); }
    }
    
    .loader {
      display: inline-block;
      width: 18px;
      height: 18px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .security-notice {
      background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(52, 211, 153, 0.1));
      border: 1px solid rgba(96, 165, 250, 0.3);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 24px;
      font-size: 13px;
      color: var(--text-secondary);
      text-align: center;
    }

    .security-notice-icon {
      color: var(--primary-color);
      margin-right: 6px;
    }
    
    .footer {
      margin-top: 32px;
      text-align: center;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: 24px;
      margin-bottom: 16px;
      font-size: 14px;
    }

    .footer-link {
      color: var(--primary-color);
      text-decoration: none;
      transition: var(--transition);
      padding: 4px 8px;
      border-radius: 4px;
    }

    .footer-link:hover {
      color: var(--primary-light);
      background-color: rgba(96, 165, 250, 0.1);
    }

    .footer-link:focus {
      outline: none;
      box-shadow: var(--focus-ring);
    }

    .footer-copyright {
      font-size: 12px;
      color: var(--text-secondary);
      opacity: 0.8;
    }

    .screen-reader-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    /* Indicador de carga de página */
    .page-loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
      transform: translateX(-100%);
      animation: pageLoad 2s ease-out forwards;
      z-index: 1000;
    }

    @keyframes pageLoad {
      to { transform: translateX(0); }
    }

    /* Mejoras de accesibilidad para modo de alto contraste */
    @media (prefers-contrast: high) {
      :root {
        --border-color: #64748b;
        --text-color: #ffffff;
        --background-color: #000000;
        --card-background: #1e293b;
      }

      .form-input:focus {
        border-width: 3px;
      }

      .submit-button {
        border: 2px solid var(--primary-color);
      }
    }

    /* Responsive design mejorado */
    @media (max-width: 480px) {
      body {
        padding: 16px;
      }

      .login-form {
        padding: 24px 20px;
      }
      
      .system-title {
        font-size: 24px;
      }

      .system-subtitle {
        font-size: 14px;
      }
      
      .form-input, .submit-button {
        padding: 12px 14px;
        font-size: 16px; /* Previene zoom en iOS */
      }

      .form-row {
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
      }

      .footer-links {
        flex-direction: column;
        gap: 12px;
      }
    }

    @media (max-width: 320px) {
      .login-container {
        max-width: 280px;
      }

      .login-form {
        padding: 20px 16px;
      }
    }

    /* Mejoras para dispositivos táctiles */
    @media (hover: none) and (pointer: coarse) {
      .submit-button:hover {
        transform: none;
        box-shadow: none;
      }

      .password-toggle {
        padding: 12px;
      }

      .form-checkbox {
        width: 20px;
        height: 20px;
      }
    }

    /* Animaciones de entrada */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .login-container {
      animation: fadeInUp 0.6s ease-out;
    }

    .login-form {
      animation: fadeInUp 0.8s ease-out 0.2s both;
    }

    /* Estados de validación mejorados */
    .form-input.error {
      border-color: var(--error-color);
      background-color: rgba(248, 113, 113, 0.1);
    }

    .form-input.success {
      border-color: var(--success-color);
      background-color: rgba(52, 211, 153, 0.1);
    }

    .form-input.warning {
      border-color: var(--warning-color);
      background-color: rgba(251, 191, 36, 0.1);
    }

    /* Indicadores de progreso */
    .progress-indicator {
      width: 100%;
      height: 2px;
      background-color: var(--border-color);
      border-radius: 1px;
      overflow: hidden;
      margin-top: 8px;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
      transition: width 0.3s ease;
      width: 0%;
    }

    /* Tooltip para ayuda contextual */
    .tooltip {
      position: relative;
      cursor: help;
    }

    .tooltip::before {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #475569;
      color: var(--text-color);
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
      z-index: 1000;
      border: 1px solid var(--border-color);
    }

    .tooltip::after {
      content: '';
      position: absolute;
      bottom: 115%;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: #475569;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .tooltip:hover::before,
    .tooltip:hover::after {
      opacity: 1;
      visibility: visible;
    }

    /* Estilos para notificaciones toast */
    .toast-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
    }

    .toast {
      background: var(--card-background);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 8px 25px var(--shadow-color);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      color: var(--text-color);
    }

    .toast.show {
      transform: translateX(0);
    }

    .toast.success {
      border-left: 4px solid var(--success-color);
    }

    .toast.error {
      border-left: 4px solid var(--error-color);
    }

    .toast.warning {
      border-left: 4px solid var(--warning-color);
    }
  </style>
</head>
<body>
  <!-- Indicador de carga de página -->
  <div class="page-loader"></div>

  <!-- Anunciador para lectores de pantalla -->
  <div id="screenReaderAnnouncer" class="screen-reader-only" aria-live="polite" aria-atomic="true"></div>

  <!-- Contenedor principal de login -->
  <div class="login-container">
    <!-- Título del sistema -->
    <h1 class="system-title">SDMO</h1>
    <p class="system-subtitle">Sistema de Gestión Administrativa</p>
    
    <!-- Formulario de login -->
    <form id="loginForm" class="login-form" novalidate aria-labelledby="loginHeading">

      <!-- Campo de email -->
      <div class="form-group">
        <label for="email" class="form-label required">Correo electrónico</label>
        <input 
          type="email" 
          id="email" 
          class="form-input"
          placeholder="usuario@dominio.com" 
          required
          autocomplete="username"
          autocapitalize="none"
          autocorrect="off"
          spellcheck="false"
          aria-describedby="emailHelp"
          maxlength="254"
        >
        <div id="emailHelp" class="screen-reader-only">
          Ingrese su dirección de correo electrónico registrada
        </div>
      </div>
      
      <!-- Campo de contraseña -->
      <div class="form-group">
        <label for="password" class="form-label required">Contraseña</label>
        <div class="password-container">
          <input 
            type="password" 
            id="password" 
            class="form-input"
            placeholder="••••••••••••" 
            required
            autocomplete="current-password"
            aria-describedby="passwordHelp passwordStrength"
            minlength="8"
            maxlength="128"
          >
          <button 
            type="button" 
            id="passwordToggle" 
            class="password-toggle" 
            aria-label="Mostrar contraseña"
            tabindex="-1"
          >
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </button>
        </div>
        <div id="passwordStrength" class="password-strength"></div>
        <div id="passwordHelp" class="screen-reader-only">
          La contraseña debe tener al menos 8 caracteres
        </div>
      </div>
      
      <!-- Opciones adicionales -->
      <div class="form-row">
        <div class="checkbox-group">
          <input type="checkbox" id="rememberMe" class="form-checkbox">
          <label for="rememberMe">Recordar en este dispositivo</label>
        </div>
      </div>
      
      <!-- Mensaje de error -->
      <div id="errorMsg" class="error-message" role="alert" aria-live="assertive"></div>
      
      <!-- Botón de envío -->
      <button type="submit" id="submitBtn" class="submit-button">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
          <polyline points="10,17 15,12 10,7"></polyline>
          <line x1="15" y1="12" x2="3" y2="12"></line>
        </svg>
        Iniciar Sesión
      </button>
    </form>
    
    <!-- Footer con enlaces -->
    <footer class="footer">
      <p class="footer-copyright">
        &copy; 2025 Sistema SDMO. Todos los derechos reservados.<br>
        <small>Versión 2.1.0 - Última actualización: Mayo 2025</small>
      </p>
    </footer>
  </div>

  <!-- Contenedor para notificaciones toast -->
  <div id="toastContainer" class="toast-container"></div>

  <!-- Scripts adicionales para funcionalidad avanzada -->
  <script>
    // Eliminar el indicador de carga después de que la página esté completamente cargada
    window.addEventListener('load', () => {
      setTimeout(() => {
        const loader = document.querySelector('.page-loader');
        if (loader) {
          loader.style.display = 'none';
        }
      }, 500);
    });

    // Sistema de notificaciones toast
    function showToast(message, type = 'info', duration = 5000) {
      const container = document.getElementById('toastContainer');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <div style="display: flex; align-items: center; gap: 8px;">
          <span>${getToastIcon(type)}</span>
          <span>${message}</span>
        </div>
      `;
      
      container.appendChild(toast);
      
      // Mostrar toast
      setTimeout(() => toast.classList.add('show'), 100);
      
      // Remover toast después del tiempo especificado
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => container.removeChild(toast), 300);
      }, duration);
    }

    function getToastIcon(type) {
      const icons = {
        success: '✅',
        error: '❌',
        warning: '⚠️',
        info: 'ℹ️'
      };
      return icons[type] || icons.info;
    }

    // Detectar modo offline/online
    window.addEventListener('online', () => {
      showToast('Conexión restablecida', 'success');
    });

    window.addEventListener('offline', () => {
      showToast('Sin conexión a internet', 'warning');
    });

    // Detectar inactividad para seguridad
    let inactivityTimer;
    const INACTIVITY_TIME = 30 * 60 * 1000; // 30 minutos

    function resetInactivityTimer() {
      clearTimeout(inactivityTimer);
      inactivityTimer = setTimeout(() => {
        showToast('Sesión expirada por inactividad', 'warning');
        // Limpiar datos sensibles
        sessionStorage.clear();
      }, INACTIVITY_TIME);
    }

    // Eventos para detectar actividad del usuario
    ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart'].forEach(event => {
      document.addEventListener(event, resetInactivityTimer, true);
    });

    resetInactivityTimer();
  </script>
</body>
</html>





